<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Connect the Heart</title>
<style>
body {
  margin: 0;
  height: 100vh;
  background: radial-gradient(circle at center, #0b0c10, #1a1a2e);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-family: 'Poppins', sans-serif;
  color: #ffdde1;
  overflow: hidden;
}

#instructions {
  margin-bottom: 12px;
  text-align: center;
  font-size: 1.05rem;
  color: #ffe4e1;
  text-shadow: 0 0 10px #ff758f;
}

#game {
  position: relative;
  width: 400px;
  height: 400px;
}

.dot {
  position: absolute;
  width: 26px;
  height: 26px;
  background: #ff758f;
  border-radius: 50%;
  box-shadow: 0 0 15px rgba(255,118,150,0.9);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  color: #3a0a0a;
  font-weight: 700;
  user-select: none;
  transition: transform .15s ease;
}
.dot.next { box-shadow: 0 0 24px rgba(255,118,150,1); transform: scale(1.15); }
.dot.done { background: #ffd1dc; color: #6b0b0b; }
.dot.shake { transform: translateX(-6px); }

#canvas { position: absolute; top: 0; left: 0; }

#commentary {
  margin-top: 18px;
  text-align: center;
  font-size: 1.05rem;
  color: #ffe4e1;
  text-shadow: 0 0 10px #ff758f;
  min-height: 1.4em;
}

button {
  margin: 10px;
  padding: 10px 20px;
  border: none;
  border-radius: 25px;
  font-size: 1rem;
  font-family: 'Poppins', sans-serif;
  cursor: pointer;
  background: linear-gradient(135deg, #ff758f, #ffa99f, #ffe29f);
  color: #4b2c20;
  box-shadow: 0 0 20px rgba(255,180,150,0.8);
  display: none;
}
button:hover { box-shadow: 0 0 30px rgba(255,200,170,1); }

@media (max-width:480px){
  #game{ transform: scale(0.9);} 
}

/* Controls container to add spacing below commentary */
.controls {
  margin-top: 34px;
  display: flex;
  gap: 12px;
  justify-content: center;
  align-items: center;
}
</style>
</head>
<body>
<div id="instructions">[ Follow the numbers and click the dots in order (1 â†’ 2 â†’ 3 â€¦) to trace the small petal ]</div>

<div id="game">
  <canvas id="canvas" width="400" height="400"></canvas>
  <!-- dots are generated by script to enforce order -->
</div>

<div id="commentary">Click the dots in order to reveal the petal ðŸ’•</div>
<div class="controls">
  <button id="playAgain">Play Again Baby?</button>
  <button id="continueBtn">Continue</button>
</div>

<!-- Background Music -->
<audio id="bgMusic" autoplay loop>
  <source src="music/romantic4.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
const commentary = document.getElementById("commentary");
const playAgainBtn = document.getElementById("playAgain");
const continueBtn = document.getElementById("continueBtn");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const game = document.getElementById("game");

// Ordered points that form a heart shape when connected in sequence
const points = [
  {x:200, y:60}, {x:170, y:95}, {x:140, y:140}, {x:120, y:190},
  {x:140, y:240}, {x:170, y:280}, {x:200, y:300}, {x:230, y:280},
  {x:260, y:240}, {x:280, y:190}, {x:260, y:140}, {x:230, y:95}
];

const sweetLines = [
  "Every line brings us closer baby ðŸ’–",
  "Youâ€™re connecting my heart rather than that petal, piece by piece, my love âœ¨",
  "Love flows through every bond we have baby ðŸŒ¹",
  "Together, we connect our story just like how you connect it all my love â¤ï¸",
  "One more line and youâ€™re stealing my heart again baby ðŸ’–",
"Careful love, every move you make pulls me closer to you âœ¨",
"Youâ€™re winning the game and my heart at the same time my love ðŸŒ¹",
"That connection? Just like us, smooth and meant to be baby ðŸ’ž",
"Every piece you link feels like a step closer to our forever â¤ï¸",
"Youâ€™re not just connecting dots, youâ€™re connecting our little universe baby ðŸŒŒ",
"Watch outâ€¦ if you keep playing like that, Iâ€™m never letting you go my love ðŸŒ™"
];

let currentIndex = 0;
let lastPos = null;

function createDots() {
  points.forEach((p, i) => {
    const dot = document.createElement('div');
    dot.className = 'dot';
    dot.style.left = (p.x - 13) + 'px';
    dot.style.top = (p.y - 13) + 'px';
    dot.dataset.index = i;
    dot.innerText = (i + 1);
    if (i === 0) dot.classList.add('next');
    game.appendChild(dot);

    dot.addEventListener('click', () => handleDotClick(dot, p, i));
  });
}

function handleDotClick(dot, pos, index) {
  if (index !== currentIndex) {
    commentary.innerText = `Tap dot ${currentIndex+1} next baby â™¥`;
    dot.classList.add('shake');
    setTimeout(() => dot.classList.remove('shake'), 300);
    return;
  }

  const centerX = pos.x;
  const centerY = pos.y;

  if (lastPos) {
    ctx.beginPath();
    ctx.moveTo(lastPos.x, lastPos.y);
    ctx.lineTo(centerX, centerY);
    ctx.strokeStyle = '#ffdde1';
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';
    ctx.shadowColor = '#ff758f';
    ctx.shadowBlur = 12;
    ctx.stroke();
  }

  commentary.innerText = sweetLines[index % sweetLines.length];
  lastPos = {x: centerX, y: centerY};
  dot.classList.add('done');
  dot.classList.remove('next');
  currentIndex++;

  const nextDot = document.querySelector(`.dot[data-index="${currentIndex}"]`);
  if (nextDot) nextDot.classList.add('next');

  if (currentIndex >= points.length) finalizeHeart();
}

function finalizeHeart() {
  commentary.innerText = "You completed my petal and completed my life baby â¤ï¸";
  playAgainBtn.style.display = 'inline-block';
  continueBtn.style.display = 'inline-block';

  // draw subtle filled heart behind the traced outline
  ctx.save();
  ctx.fillStyle = 'rgba(255,118,150,0.12)';
  ctx.beginPath();
  ctx.moveTo(200, 280);
  ctx.bezierCurveTo(120, 220, 120, 140, 200, 110);
  ctx.bezierCurveTo(280, 140, 280, 220, 200, 280);
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}

function resetGame() {
  currentIndex = 0;
  lastPos = null;
  commentary.innerText = 'Click the dots in order: 1 â†’ 2 â†’ 3 â†’ ... to reveal the small petal ðŸ’•';
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  document.querySelectorAll('.dot').forEach(d => d.remove());
  playAgainBtn.style.display = 'none';
  continueBtn.style.display = 'none';
  createDots();
}

createDots();
commentary.innerText = 'Click the dots in order: 1 â†’ 2 â†’ 3 â†’ ... to reveal the small petal ðŸ’•';

playAgainBtn.addEventListener('click', resetGame);
continueBtn.addEventListener('click', () => { if(window.navigateTo) navigateTo('closing.html'); else window.location.href = 'closing.html'; });

// Ensure music plays even if autoplay is blocked
document.addEventListener('DOMContentLoaded', () => {
  const music = document.getElementById('bgMusic');
  if (!music) return;
  music.play().catch(() => {
    document.body.addEventListener('click', () => {
      music.play();
    }, { once: true });
  });
});
</script>
<!-- Page transition snippet -->
<style>
  body.page-transition{opacity:0;transform:translateY(6px);transition:opacity .5s ease, transform .5s ease}
  body.page-ready{opacity:1;transform:none}
  body.page-going{opacity:0;transform:translateY(-6px)}
</style>
<script>
  (function(){
    const body=document.body; body.classList.add('page-transition');
    window.addEventListener('DOMContentLoaded',()=>{body.classList.add('page-ready'); body.classList.remove('page-transition')});
    document.addEventListener('click', e=>{const a=e.target.closest('a[href]'); if(!a) return; const href=a.getAttribute('href'); if(href.startsWith('#')||href.startsWith('mailto:')||href.startsWith('javascript:')) return; e.preventDefault(); body.classList.add('page-going'); setTimeout(()=>location.href=href,450);});
    window.navigateTo=function(url){ body.classList.add('page-going'); setTimeout(()=>location.href=url,450); };
  })();
</script>
</body>
</html>